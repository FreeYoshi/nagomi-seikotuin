<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="config/env.js"></script>
    <script src="config/config.js"></script>
    <!-- flatpickr CSS/JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta charset="UTF-8">
    <title>å’Œæ•´éª¨é™¢ - ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: #f8f9fa;
        }
        
        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */
        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        }
        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #1a237e;
            font-weight: 700;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #1a237e;
            font-size: 14px;
        }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.3);
            border-width: 2px;
        }
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(26, 35, 126, 0.3);
        }
        .login-btn:hover {
            transform: translateY(-2px);
        }
        .error-msg {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        
        /* ç®¡ç†ç”»é¢ */
        .admin-container {
            display: none;
            min-height: 100vh;
        }
        .header {
            background: #2c5282;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
        }
        .logout-btn {
            padding: 8px 15px;
            background: transparent;
            color: white;
            border: 1px solid white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .main-content {
            display: flex;
        }
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            min-height: calc(100vh - 60px);
        }
        .nav-menu {
            list-style: none;
            padding: 20px 0;
        }
        .nav-menu li {
            border-bottom: 1px solid #e9ecef;
        }
        .nav-menu a {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            transition: background 0.3s;
        }
        .nav-menu a:hover,
        .nav-menu a.active {
            background: #1a237e;
            color: white;
            font-weight: 600;
            border-left: 4px solid #3f51b5;
        }
        
        .content {
            flex: 1;
            padding: 30px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        
        /* äºˆç´„ä¸€è¦§ */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .admin-table thead {
            background: #2c5282;
            color: white;
        }
        .admin-table th,
        .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        .admin-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-danger {
            background: #b71c1c;
            color: white;
            font-weight: 700;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-success {
            background: #1b5e20;
            color: white;
            font-weight: 700;
        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-warning {
            background: #e65100;
            color: white;
            font-weight: 700;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        
        /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† */
        .schedule-controls {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .control-group {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .control-group h4 {
            margin-bottom: 15px;
            color: #1a237e;
            font-weight: 700;
            font-size: 20px;
        }
        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }
        .control-row input,
        .control-row select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        .modal-buttons {
            margin-top: 20px;
        }
        .modal-btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .modal-btn.confirm {
            background: #dc3545;
            color: white;
        }
        .modal-btn.cancel {
            background: #6c757d;
            color: white;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
            .header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .header h1 {
                font-size: 18px;
            }
            
            /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
            .main-content {
                flex-direction: column;
            }
            
            /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
            .sidebar {
                width: 100%;
                min-height: auto;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .nav-menu {
                display: flex;
                padding: 0;
                overflow-x: auto;
                white-space: nowrap;
            }
            .nav-menu li {
                border-bottom: none;
                border-right: 1px solid #e9ecef;
                flex-shrink: 0;
            }
            .nav-menu li:last-child {
                border-right: none;
            }
            .nav-menu a {
                padding: 12px 20px;
                font-size: 14px;
                white-space: nowrap;
            }
            
            /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
            .content {
                padding: 15px;
            }
            
            /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            }
            .admin-table {
                min-width: 700px;
            }
            .admin-table th,
            .admin-table td {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            /* ãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
            .btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† */
            .schedule-controls {
                padding: 15px;
            }
            .control-group {
                padding: 15px;
                margin-bottom: 15px;
            }
            .control-group h4 {
                font-size: 16px;
                margin-bottom: 10px;
            }
            .control-row {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            .control-row input,
            .control-row select {
                width: 100%;
                padding: 10px;
                font-size: 16px;
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
            .modal-content {
                width: 95%;
                padding: 20px;
                margin: 10% auto;
            }
            .modal-btn {
                padding: 12px 20px;
                font-size: 14px;
                margin: 5px;
            }
            
            /* ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  */
            .login-form {
                padding: 30px 20px;
                margin: 20px;
            }
        }
        
        /* ã•ã‚‰ã«å°ã•ãªç”»é¢ç”¨ */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 16px;
            }
            .nav-menu a {
                padding: 10px 15px;
                font-size: 12px;
            }
            .content {
                padding: 10px;
            }
            .admin-table {
                min-width: 600px;
            }
            .admin-table th,
            .admin-table td {
                padding: 6px 8px;
                font-size: 12px;
            }
            .btn {
                padding: 4px 8px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginContainer" class="login-container">
        <form id="loginForm" class="login-form">
            <h2><i class="fas fa-lock"></i> ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <div id="loginError" class="error-msg" style="display: none;"></div>
            <div class="form-group">
                <label for="adminId"><i class="fas fa-user"></i> ç®¡ç†è€…ID</label>
                <input type="text" id="adminId" required>
            </div>
            <div class="form-group">
                <label for="password"><i class="fas fa-key"></i> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" id="forgotPasswordLink" style="color: #1a237e; text-decoration: none; font-size: 14px;">
                    <i class="fas fa-question-circle"></i> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆ
                </a>
            </div>
        </form>
    </div>
    
    <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”»é¢ -->
    <div id="resetContainer" class="login-container" style="display: none;">
        <form id="resetForm" class="login-form">
            <h2><i class="fas fa-key"></i> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 14px;">
                ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒªãƒ³ã‚¯ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚
            </p>
            <div id="resetError" class="error-msg" style="display: none;"></div>
            <div id="resetSuccess" style="display: none; color: #28a745; background: #d4edda; padding: 10px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #c3e6cb;"></div>
            <div class="form-group">
                <label for="resetEmail"><i class="fas fa-envelope"></i> ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="resetEmail" required>
            </div>
            <button type="submit" class="login-btn">
                <i class="fas fa-paper-plane"></i> ãƒªã‚»ãƒƒãƒˆãƒªãƒ³ã‚¯ã‚’é€ä¿¡
            </button>
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" id="backToLoginLink" style="color: #1a237e; text-decoration: none; font-size: 14px;">
                    <i class="fas fa-arrow-left"></i> ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
                </a>
            </div>
        </form>
    </div>
    
    <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°ç”»é¢ -->
    <div id="updatePasswordContainer" class="login-container" style="display: none;">
        <form id="updatePasswordForm" class="login-form">
            <h2><i class="fas fa-lock"></i> æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 14px;">
                æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
            </p>
            <div id="updateError" class="error-msg" style="display: none;"></div>
            <div class="form-group">
                <label for="newPasswordReset"><i class="fas fa-key"></i> æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="newPasswordReset" required minlength="6">
            </div>
            <div class="form-group">
                <label for="confirmPasswordReset"><i class="fas fa-key"></i> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª</label>
                <input type="password" id="confirmPasswordReset" required>
            </div>
            <button type="submit" class="login-btn">
                <i class="fas fa-check"></i> ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›´æ–°
            </button>
        </form>
    </div>

    <!-- ç®¡ç†ç”»é¢ -->
    <div id="adminContainer" class="admin-container">
        <header class="header">
            <h1><i class="fas fa-user-shield"></i> å’Œæ•´éª¨é™¢ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <button id="logoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
        </header>
        
        <div class="main-content">
            <nav class="sidebar">
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="reservations">
                        <i class="fas fa-calendar-check"></i> äºˆç´„ä¸€è¦§
                    </a></li>
                    <li><a href="#" class="nav-link" data-section="schedule">
                        <i class="fas fa-clock"></i> ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
                    </a></li>
                </ul>
            </nav>
            
            <main class="content">
                <!-- äºˆç´„ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section id="reservationsSection" class="content-section active">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <h2><i class="fas fa-calendar-check"></i> äºˆç´„ä¸€è¦§</h2>
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <button onclick="changeMonth(-1)" class="btn" style="background: #6c757d; color: white; padding: 8px 12px;">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <select id="monthFilter" onchange="loadReservations()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 140px;">
                                </select>
                                <button onclick="changeMonth(1)" class="btn" style="background: #6c757d; color: white; padding: 8px 12px;">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <button onclick="loadReservations()" class="btn btn-success">
                                <i class="fas fa-sync-alt"></i> æ›´æ–°
                            </button>
                            <span id="lastUpdateTime" style="color: #666; font-size: 12px;"></span>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="reservationTable" class="admin-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-user"></i> ãŠåå‰</th>
                                    <th><i class="fas fa-phone"></i> é›»è©±ç•ªå·</th>
                                    <th><i class="fas fa-calendar-check"></i> äºˆç´„æ—¥æ™‚</th>
                                    <th><i class="fas fa-list"></i> ã‚³ãƒ¼ã‚¹</th>
                                    <th><i class="fas fa-user-plus"></i> é¡”å®¢åŒºåˆ†</th>
                                    <th><i class="fas fa-route"></i> çµŒç·¯</th>
                                    <th><i class="fas fa-cog"></i> æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section id="scheduleSection" class="content-section">
                    <h2><i class="fas fa-clock"></i> ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h2>
                    <div class="schedule-controls">
                        <div class="control-group" style="background: #fafafa; border: 3px solid #d32f2f; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                            <h4 style="color: #d32f2f; font-size: 22px; font-weight: bold; margin-bottom: 20px; text-align: center;"><i class="fas fa-ban"></i> ğŸš« ä¼‘æ¥­è¨­å®š</h4>
                            
                            <!-- çµ‚æ—¥ä¼‘æ¥­è¨­å®š -->
                            <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 3px solid #ef6c00;">
                                <h4 style="color: #ef6c00; margin-bottom: 15px; font-size: 18px; font-weight: bold;"><i class="fas fa-calendar-times"></i> ğŸš« çµ‚æ—¥ä¼‘æ¥­è¨­å®š</h4>
                                <p style="color: #333333; margin-bottom: 15px; font-size: 14px; font-weight: 500;">æŒ‡å®šã—ãŸæ—¥ä»˜ã‚’ä¸€æ—¥ä¸­ä¼‘æ¥­ã«ã—ã¾ã™ã€‚ã“ã®è¨­å®šã‚’ã™ã‚‹ã¨æ™‚é–“æŒ‡å®šä¼‘æ¥­ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚</p>
                                <div class="control-row">
                                    <label>ä¼‘æ¥­æ—¥ä»˜:</label>
                                    <input type="date" id="closedDate">
                                    <button class="btn" onclick="setDayClosed()" style="background: #ef6c00; color: white; font-weight: bold; border: none; padding: 12px 20px; border-radius: 6px;">
                                        <i class="fas fa-times"></i> ğŸš« çµ‚æ—¥ä¼‘æ¥­è¨­å®š
                                    </button>
                                </div>
                            </div>
                            <!-- æ™‚é–“ç¯„å›²ä¼‘æ¥­è¨­å®š -->
                            <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 3px solid #7b1fa2;">
                                <h4 style="color: #7b1fa2; margin-bottom: 15px; font-size: 18px; font-weight: bold;"><i class="fas fa-clock"></i> â° æ™‚é–“ç¯„å›²ä¼‘æ¥­è¨­å®š</h4>
                                <p style="color: #333333; margin-bottom: 15px; font-size: 14px; font-weight: 500;">æŒ‡å®šã—ãŸæ—¥ä»˜ã®ç‰¹å®šæ™‚é–“ç¯„å›²ã‚’ä¼‘æ¥­ã«ã—ã¾ã™ã€‚<br><strong>ä¾‹ï¼š15:00ã€œ18:00è¨­å®šâ†’ 15:00, 15:30, 16:00, 16:30, 17:00, 17:30ãŒä¼‘æ¥­ï¼ˆ18:00ã‹ã‚‰å–¶æ¥­å†é–‹ï¼‰</strong></p>
                                <div class="control-row">
                                    <label>ä¼‘æ¥­æ—¥ä»˜:</label>
                                    <input type="date" id="closedTimeDate">
                                    <select id="closedTimeStart">
                                        <option value="">é–‹å§‹æ™‚é–“</option>
                                    </select>
                                    <span style="margin: 0 10px; font-weight: bold;">ã€œ</span>
                                    <select id="closedTimeEnd">
                                        <option value="">çµ‚äº†æ™‚é–“</option>
                                    </select>
                                    <button class="btn" onclick="setTimeRangeClosed()" style="background: #7b1fa2; color: white; font-weight: bold; border: none; padding: 12px 20px; border-radius: 6px;">
                                        <i class="fas fa-times"></i> â° æ™‚é–“ç¯„å›²ä¼‘æ¥­
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-group" style="background: #f1f8e9; border: 3px solid #388e3c; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                            <h4 style="color: #388e3c; font-size: 22px; font-weight: bold; margin-bottom: 20px; text-align: center;"><i class="fas fa-check"></i> âœ… å–¶æ¥­å†é–‹</h4>
                            
                            <!-- çµ‚æ—¥å–¶æ¥­è¨­å®š -->
                            <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 3px solid #1976d2;">
                                <h4 style="color: #1976d2; margin-bottom: 15px; font-size: 18px; font-weight: bold;"><i class="fas fa-calendar-check"></i> âœ… çµ‚æ—¥å–¶æ¥­è¨­å®š</h4>
                                <p style="color: #333333; margin-bottom: 15px; font-size: 14px; font-weight: 500;">æ—¥æ›œãƒ»ç¥æ—¥ãªã©ã®ä¼‘è¨ºæ—¥ã‚’ç‰¹åˆ¥ã«å–¶æ¥­æ—¥ã«å¤‰æ›´ã—ã¾ã™ã€‚</p>
                                <div class="control-row">
                                    <label>å–¶æ¥­æ—¥ä»˜:</label>
                                    <input type="date" id="openDate">
                                    <button class="btn" onclick="setDayOpen()" style="background: #1976d2; color: white; font-weight: bold; border: none; padding: 12px 20px; border-radius: 6px;">
                                        <i class="fas fa-check"></i> âœ… çµ‚æ—¥å–¶æ¥­è¨­å®š
                                    </button>
                                </div>
                            </div>
                            <!-- æ™‚é–“ç¯„å›²å–¶æ¥­è¨­å®š -->
                            <div style="background: #e0f2f1; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 3px solid #00796b;">
                                <h4 style="color: #00796b; margin-bottom: 15px; font-size: 18px; font-weight: bold;"><i class="fas fa-clock"></i> ğŸ•°ï¸ æ™‚é–“ç¯„å›²å–¶æ¥­è¨­å®š</h4>
                                <p style="color: #333333; margin-bottom: 15px; font-size: 14px; font-weight: 500;">ä¼‘æ¥­è¨­å®šã—ãŸæ™‚é–“ç¯„å›²ã‚’è§£é™¤ã—ã¦å–¶æ¥­ã«æˆ»ã—ã¾ã™ã€‚<br><strong>æ³¨æ„ï¼šç¯„å›²å†…ã®å„æ™‚é–“å¸¯ã‚’å€‹åˆ¥ã«å‰Šé™¤ã—ã¾ã™</strong></p>
                                <div class="control-row">
                                    <label>å–¶æ¥­æ—¥ä»˜:</label>
                                    <input type="date" id="openTimeDate">
                                    <select id="openTimeStart">
                                        <option value="">é–‹å§‹æ™‚é–“</option>
                                    </select>
                                    <span style="margin: 0 10px; font-weight: bold;">ã€œ</span>
                                    <select id="openTimeEnd">
                                        <option value="">çµ‚äº†æ™‚é–“</option>
                                    </select>
                                    <button class="btn" onclick="setTimeRangeOpen()" style="background: #00796b; color: white; font-weight: bold; border: none; padding: 12px 20px; border-radius: 6px;">
                                        <i class="fas fa-check"></i> ğŸ•°ï¸ æ™‚é–“ç¯„å›²å–¶æ¥­
                                    </button>
                                </div>
                            </div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                                <h4 style="margin: 0;"><i class="fas fa-list"></i> ä¼‘æ¥­ãƒ»å–¶æ¥­å±¥æ­´</h4>
                                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <button onclick="changeScheduleMonth(-1)" class="btn" style="background: #6c757d; color: white; padding: 8px 12px;">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <select id="scheduleMonthFilter" onchange="loadScheduleOverrides()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 140px;"></select>
                                        <button onclick="changeScheduleMonth(1)" class="btn" style="background: #6c757d; color: white; padding: 8px 12px;">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                    <button onclick="loadScheduleOverrides()" class="btn btn-success">
                                        <i class="fas fa-sync-alt"></i> æ›´æ–°
                                    </button>
                                    <span id="scheduleLastUpdateTime" style="color: #666; font-size: 12px;"></span>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table id="scheduleTable" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>æ—¥ä»˜</th>
                                            <th>é–‹å§‹æ™‚é–“</th>
                                            <th>çµ‚äº†æ™‚é–“</th>
                                            <th>çŠ¶æ…‹</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle"></i> äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèª</h3>
            <p id="cancelMessage">ã“ã®äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ</p>
            <div class="modal-buttons">
                <button id="confirmCancel" class="modal-btn confirm">
                    <i class="fas fa-trash"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹
                </button>
                <button id="cancelCancel" class="modal-btn cancel">
                    <i class="fas fa-times"></i> æˆ»ã‚‹
                </button>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ç¢ºèª
        console.log('ğŸ” è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª:', {
            AppConfigExists: !!window.AppConfig,
            AppLoggerExists: !!window.AppLogger,
            windowKeys: Object.keys(window).filter(key => key.startsWith('App'))
        });
        
        if (!window.AppConfig) {
            console.error('âŒ AppConfig ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼');
            console.log('ğŸ“ åˆ©ç”¨å¯èƒ½ãªwindowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', Object.keys(window).slice(0, 20));
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šã‚’æä¾›
            console.log('ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šã‚’ä½¿ç”¨ã—ã¾ã™...');
            window.AppConfig = {
                getSupabaseConfig: () => ({
                    url: 'https://oybjnhtyogxiwvsldxhj.supabase.co',
                    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95YmpuaHR5b2d4aXd2c2xkeGhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0Nzk3MDQsImV4cCI6MjA4MDA1NTcwNH0.6IwN-RWr3imbRotjb3CG4OYYssP50CBUuIFE-xndjd4'
                }),
                getEmailJSConfig: () => ({
                    publicKey: 'KyHtLCaZ6C6XEpcv0',
                    serviceId: 'service_ppi835a',
                    templateId: 'template_jcdlzq6'
                }),
                tables: {
                    reservations: 'reservations',
                    adminUsers: 'admin_users',
                    scheduleOverrides: 'schedule_overrides'
                }
            };
            
            window.AppLogger = {
                info: (msg, data) => console.log(`[INFO] ${msg}`, data || ''),
                error: (msg, data) => console.error(`[ERROR] ${msg}`, data || ''),
                warn: (msg, data) => console.warn(`[WARN] ${msg}`, data || '')
            };
            
            console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šå®Œäº†');
        }
        
        let supabaseConfig, SUPABASE_URL, SUPABASE_KEY, reservationTable, adminTable, scheduleTable;
        
        try {
            supabaseConfig = window.AppConfig.getSupabaseConfig();
            SUPABASE_URL = supabaseConfig.url;
            SUPABASE_KEY = supabaseConfig.key;
            reservationTable = window.AppConfig.tables.reservations;
            adminTable = window.AppConfig.tables.adminUsers;
            scheduleTable = window.AppConfig.tables.scheduleOverrides;
            
            console.log('âœ… è¨­å®šç¢ºèª:', { 
                url: SUPABASE_URL, 
                keyPrefix: SUPABASE_KEY ? SUPABASE_KEY.substring(0, 20) + '...' : 'ãªã—',
                adminTable,
                configLoaded: true
            });
            
            if (!SUPABASE_URL || !SUPABASE_KEY) {
                throw new Error('Supabaseè¨­å®šãŒä¸å®Œå…¨ã§ã™');
            }
            
        } catch (error) {
            console.error('âŒ è¨­å®šå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            alert('ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚');
            throw error;
        }

        // Supabase JSãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­è¾¼
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js';
        script.onload = () => {
            try {
                console.log('ğŸ“¦ Supabase SDKèª­ã¿è¾¼ã¿å®Œäº†');
                console.log('ğŸ”‘ Supabaseè¨­å®š:', { 
                    url: SUPABASE_URL, 
                    keyPrefix: SUPABASE_KEY ? SUPABASE_KEY.substring(0, 20) + '...' : 'æœªè¨­å®š',
                    sdkExists: typeof supabase !== 'undefined'
                });
                
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase SDK ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                if (!SUPABASE_URL || !SUPABASE_KEY) {
                    throw new Error('Supabaseè¨­å®šãŒä¸å®Œå…¨ã§ã™');
                }
                
                window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('âœ… Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆæˆåŠŸ');
                
                // æ¥ç¶šãƒ†ã‚¹ãƒˆ
                window.supabase.from('reservations').select('count', { count: 'exact', head: true })
                    .then(result => {
                        console.log('ğŸ”— Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ:', result);
                    })
                    .catch(error => {
                        console.warn('âš ï¸ Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—ï¼ˆã“ã‚Œã¯æ­£å¸¸ãªå ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼‰:', error.message);
                    });
                
                if (window.AppLogger) {
                    window.AppLogger.info('SupabaseåˆæœŸåŒ–å®Œäº†', { url: SUPABASE_URL, keyPrefix: SUPABASE_KEY.substring(0, 20) + '...' });
                }
                
                initApp();
                
            } catch (error) {
                console.error('âŒ SupabaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                console.log('ğŸ” ã‚¨ãƒ©ãƒ¼è©³ç´°:', {
                    message: error.message,
                    stack: error.stack,
                    supabaseExists: typeof supabase !== 'undefined',
                    urlExists: !!SUPABASE_URL,
                    keyExists: !!SUPABASE_KEY
                });
                alert(`ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            }
        };
        
        script.onerror = () => {
            console.error('Supabaseãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            alert('å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        };
        document.head.appendChild(script);

        function initApp() {
            // EmailJSåˆæœŸåŒ–
            const emailJSConfig = window.AppConfig.getEmailJSConfig();
            try {
                emailjs.init(emailJSConfig.publicKey);
                window.emailJSEnabled = true;
            } catch (error) {
                window.AppLogger.error('EmailJSåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                window.emailJSEnabled = false;
            }

            // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                // å‰å›ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¾©å…ƒï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯é™¤å¤–ï¼‰
                let lastActiveSection = localStorage.getItem('lastActiveSection') || 'reservations';
                
                // å‰Šé™¤ã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã¯äºˆç´„ä¸€è¦§ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                if (lastActiveSection === 'password') {
                    lastActiveSection = 'reservations';
                    localStorage.setItem('lastActiveSection', 'reservations');
                }
                
                showSection(lastActiveSection);
                showAdminPanel();
            }
            
            setupEventListeners();
            setupPasswordResetListeners();
            initializeFormElements();
            initMonthFilter();
            initMonthFilter('scheduleMonthFilter');
        }
        
        function setupPasswordResetListeners() {
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆé–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const forgotLink = document.getElementById('forgotPasswordLink');
            const backLink = document.getElementById('backToLoginLink');
            const resetForm = document.getElementById('resetForm');
            const updateForm = document.getElementById('updatePasswordForm');
            
            if (forgotLink) {
                forgotLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showResetForm();
                });
            }
            
            if (backLink) {
                backLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showLoginForm();
                });
            }
            
            if (resetForm) {
                resetForm.addEventListener('submit', handlePasswordReset);
            }
            
            if (updateForm) {
                updateForm.addEventListener('submit', handlePasswordUpdate);
            }
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°ç”»é¢ã‚’è¡¨ç¤º
            const urlParams = new URLSearchParams(window.location.search);
            const accessToken = urlParams.get('access_token');
            const type = urlParams.get('type');
            
            if (type === 'recovery' && accessToken) {
                showPasswordUpdateForm();
            }
        }
        
        function showLoginForm() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('resetContainer').style.display = 'none';
            document.getElementById('updatePasswordContainer').style.display = 'none';
        }
        
        function showResetForm() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('resetContainer').style.display = 'flex';
            document.getElementById('updatePasswordContainer').style.display = 'none';
        }
        
        function showPasswordUpdateForm() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('resetContainer').style.display = 'none';
            document.getElementById('updatePasswordContainer').style.display = 'flex';
        }
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
        async function handlePasswordReset(e) {
            e.preventDefault();
            
            const email = document.getElementById('resetEmail').value;
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');
            
            try {
                const { error } = await window.supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: `${window.location.origin}/admin.html`
                });
                
                if (error) {
                    errorDiv.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                    errorDiv.style.display = 'block';
                    successDiv.style.display = 'none';
                    return;
                }
                
                errorDiv.style.display = 'none';
                successDiv.innerHTML = `
                    <i class="fas fa-check-circle"></i> 
                    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚<br>
                    ãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªã®ä¸Šã€è¨˜è¼‰ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†è¨­å®šã—ã¦ãã ã•ã„ã€‚
                `;
                successDiv.style.display = 'block';
                
            } catch (error) {
                window.AppLogger.error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
                errorDiv.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                errorDiv.style.display = 'block';
            }
        }
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°å‡¦ç†ï¼ˆãƒªã‚»ãƒƒãƒˆãƒªãƒ³ã‚¯ã‹ã‚‰ï¼‰
        async function handlePasswordUpdate(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPasswordReset').value;
            const confirmPassword = document.getElementById('confirmPasswordReset').value;
            const errorDiv = document.getElementById('updateError');
            
            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (newPassword.length < 6) {
                errorDiv.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„';
                errorDiv.style.display = 'block';
                return;
            }
            
            try {
                const { error } = await window.supabase.auth.updateUser({
                    password: newPassword
                });
                
                if (error) {
                    errorDiv.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                    errorDiv.style.display = 'block';
                    return;
                }
                
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚');
                showLoginForm();
                
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                window.history.replaceState({}, document.title, window.location.pathname);
                
            } catch (error) {
                window.AppLogger.error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                errorDiv.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                errorDiv.style.display = 'block';
            }
        }
        


        // åˆæœŸåŒ–å‡¦ç†
        function initializeFormElements() {
            // æ™‚é–“é¸æŠè‚¢ã‚’ç”Ÿæˆ
            generateTimeOptions();
            
            // æ—¥ä»˜å¤‰æ›´æ™‚ã®é€£å‹•å‡¦ç†ã‚’è¨­å®š
            setupDateChangeHandlers();
            
            // åˆæœŸçŠ¶æ…‹ã§æ™‚é–“é¸æŠã‚’ç„¡åŠ¹åŒ–
            document.getElementById('closedTimeStart').disabled = true;
            document.getElementById('closedTimeEnd').disabled = true;
            document.getElementById('openTimeStart').disabled = true;
            document.getElementById('openTimeEnd').disabled = true;
        }

        function setupEventListeners() {
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    
                    // ã‚¹ãƒãƒ›ã§ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’å³åº§ã«æ›´æ–°
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    showSection(section);
                });
                
                // ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ›ãƒãƒ¼åŠ¹æœã‚’æ”¹å–„
                link.addEventListener('touchstart', function() {
                    this.style.backgroundColor = '#1a237e';
                }, {passive: true});
                
                link.addEventListener('touchend', function() {
                    setTimeout(() => {
                        if (!this.classList.contains('active')) {
                            this.style.backgroundColor = '';
                        }
                    }, 150);
                }, {passive: true});
            });
            

            
            // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«
            document.getElementById('confirmCancel').addEventListener('click', handleCancelConfirm);
            document.getElementById('cancelCancel').addEventListener('click', () => {
                document.getElementById('cancelModal').style.display = 'none';
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const adminIdInput = document.getElementById('adminId');
            const passwordInput = document.getElementById('password');
            
            if (!adminIdInput || !passwordInput) {
                console.error('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                showLoginError('ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                return;
            }
            
            const adminId = adminIdInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!adminId || !password) {
                showLoginError('ç®¡ç†è€…IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            console.log('ğŸ”„ ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ:', { 
                adminId, 
                tableConfig: adminTable,
                supabaseExists: !!window.supabase,
                passwordLength: password.length
            });
            
            if (!window.supabase) {
                console.error('âŒ SupabaseãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                showLoginError('ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            try {
                console.log('ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èªè¨¼é–‹å§‹...');
                console.log('ğŸ” ã‚¯ã‚¨ãƒªè©³ç´°:', { 
                    table: adminTable,
                    searchId: adminId,
                    passwordLength: password.length
                });
                
                // ã¾ãšç®¡ç†è€…IDã ã‘ã§æ¤œç´¢ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
                const { data: userExists, error: userError } = await window.supabase
                    .from(adminTable)
                    .select('id, password_hash')
                    .eq('id', adminId);
                
                console.log('ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèª:', { 
                    userExists: userExists?.length > 0,
                    userCount: userExists?.length,
                    userError: userError?.message,
                    foundIds: userExists?.map(u => u.id)
                });
                
                if (userError) {
                    console.error('âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', userError);
                    showLoginError(`ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${userError.message}`);
                    return;
                }
                
                if (!userExists || userExists.length === 0) {
                    console.log('âŒ ç®¡ç†è€…IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', adminId);
                    showLoginError('ç®¡ç†è€…IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }
                
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚å«ã‚ãŸå®Œå…¨èªè¨¼
                const { data, error } = await window.supabase
                    .from(adminTable)
                    .select('*')
                    .eq('id', adminId)
                    .eq('password_hash', password)
                    .single();
                
                console.log('ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼çµæœ:', { 
                    dataExists: !!data, 
                    errorExists: !!error,
                    errorMessage: error?.message,
                    errorCode: error?.code,
                    dataId: data?.id,
                    storedPassword: userExists[0]?.password_hash,
                    inputPassword: password,
                    passwordMatch: userExists[0]?.password_hash === password
                });
                
                if (error) {
                    console.error('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
                    if (error.code === 'PGRST116') {
                        showLoginError('ç®¡ç†è€…IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                    } else {
                        showLoginError(`ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    }
                    return;
                }
                
                if (!data) {
                    console.log('âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    showLoginError('ç®¡ç†è€…IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }
                
                console.log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ:', data.id);
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('adminId', adminId);
                showAdminPanel();
                
            } catch (error) {
                console.error('âŒ èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                showLoginError(`èªè¨¼å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        function handleLogout() {
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showAdminPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            
            // ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            const activeSection = document.querySelector('.nav-link.active');
            const sectionName = activeSection ? activeSection.dataset.section : 'reservations';
            
            if (sectionName === 'reservations') {
                loadReservations();
                
                // 30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°ï¼ˆäºˆç´„ä¸€è¦§ã®ã¿ï¼‰
                setInterval(() => {
                    const currentSection = document.querySelector('.nav-link.active')?.dataset.section;
                    if (currentSection === 'reservations') {
                        console.log('ğŸ”„ äºˆç´„ãƒ‡ãƒ¼ã‚¿è‡ªå‹•æ›´æ–°');
                        loadReservations();
                    }
                }, 30000);
            } else if (sectionName === 'schedule') {
                loadScheduleOverrides();
            }
        }

        function showSection(sectionName) {
            console.log('ğŸ”„ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ:', sectionName);
            
            // æœ‰åŠ¹ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³åã‹ãƒã‚§ãƒƒã‚¯
            const validSections = ['reservations', 'schedule'];
            if (!validSections.includes(sectionName)) {
                console.warn('âš ï¸ ç„¡åŠ¹ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³å:', sectionName, '-> reservationsã«å¤‰æ›´');
                sectionName = 'reservations';
            }
            
            try {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const navLink = document.querySelector(`[data-section="${sectionName}"]`);
                if (navLink) {
                    navLink.classList.add('active');
                } else {
                    console.warn('âš ï¸ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', sectionName);
                }
                
                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                const targetSection = document.getElementById(`${sectionName}Section`);
                if (targetSection) {
                    targetSection.classList.add('active');
                    console.log('âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºæˆåŠŸ:', sectionName);
                } else {
                    console.error('âŒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', `${sectionName}Section`);
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤º
                    const reservationsSection = document.getElementById('reservationsSection');
                    if (reservationsSection) {
                        reservationsSection.classList.add('active');
                        sectionName = 'reservations';
                    }
                }
                
                // ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                localStorage.setItem('lastActiveSection', sectionName);
                
                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã®åˆæœŸåŒ–å‡¦ç†
                if (sectionName === 'reservations') {
                    loadReservations();
                } else if (sectionName === 'schedule') {
                    loadScheduleOverrides();
                }
                
            } catch (error) {
                console.error('âŒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯äºˆç´„ä¸€è¦§ã‚’å¼·åˆ¶è¡¨ç¤º
                try {
                    const reservationsSection = document.getElementById('reservationsSection');
                    if (reservationsSection) {
                        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                        reservationsSection.classList.add('active');
                        localStorage.setItem('lastActiveSection', 'reservations');
                    }
                } catch (fallbackError) {
                    console.error('âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚‚å¤±æ•—:', fallbackError);
                }
            }
        }

        // æ—¥ä»˜ã‚’æ›œæ—¥ä»˜ãã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹é–¢æ•°
        function formatDateWithDay(datetimeStr) {
            const dt = new Date(datetimeStr);
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            const dayName = dayNames[dt.getDay()];

            const year = dt.getFullYear();
            const month = String(dt.getMonth() + 1).padStart(2, '0');
            const date = String(dt.getDate()).padStart(2, '0');
            const hour = String(dt.getHours()).padStart(2, '0');
            const minute = String(dt.getMinutes()).padStart(2, '0');

            return `${year}-${month}-${date} (${dayName}) ${hour}:${minute}`;
        }

        // æœˆé¸æŠè‚¢ã®åˆæœŸåŒ–
        function initMonthFilter(selectId = 'monthFilter') {
            const select = document.getElementById(selectId);
            if (!select) return;

            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();

            const previousValue = select.value;

            select.innerHTML = '';

            // éå»12ãƒ¶æœˆ + ä»Šæœˆ + æœªæ¥3ãƒ¶æœˆã‚’é¸æŠè‚¢ã«è¿½åŠ 
            for (let i = -12; i <= 3; i++) {
                const date = new Date(currentYear, currentMonth + i, 1);
                const year = date.getFullYear();
                const month = date.getMonth();
                const value = `${year}-${String(month + 1).padStart(2, '0')}`;
                const label = `${year}å¹´${month + 1}æœˆ`;

                const option = document.createElement('option');
                option.value = value;
                option.textContent = label;

                if (previousValue) {
                    option.selected = value === previousValue;
                } else if (i === 0) {
                    option.selected = true;
                }

                select.appendChild(option);
            }
        }

        // æœˆã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°
        function changeMonth(direction) {
            adjustMonthSelection('monthFilter', loadReservations, direction);
        }

        function changeScheduleMonth(direction) {
            adjustMonthSelection('scheduleMonthFilter', loadScheduleOverrides, direction);
        }

        function adjustMonthSelection(selectId, reloadFn, direction) {
            const select = document.getElementById(selectId);
            if (!select) return;

            const currentIndex = select.selectedIndex;
            const newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < select.options.length) {
                select.selectedIndex = newIndex;
                reloadFn();
            }
        }

        function getMonthRangeFromSelect(selectId) {
            const select = document.getElementById(selectId);
            let year;
            let month;

            if (select && select.value) {
                const [yearStr, monthStr] = select.value.split('-');
                year = Number(yearStr);
                month = Number(monthStr);
            } else {
                const now = new Date();
                year = now.getFullYear();
                month = now.getMonth() + 1;
            }

            const paddedMonth = String(month).padStart(2, '0');
            const lastDay = new Date(year, month, 0).getDate();

            return {
                startDateStr: `${year}-${paddedMonth}-01`,
                endDateStr: `${year}-${paddedMonth}-${String(lastDay).padStart(2, '0')}`,
                label: `${year}å¹´${month}æœˆ`
            };
        }

        // äºˆç´„ä¸€è¦§ã®èª­ã¿è¾¼ã¿
        async function loadReservations() {
            console.log('ğŸ“‹ äºˆç´„ä¸€è¦§èª­ã¿è¾¼ã¿é–‹å§‹');
            console.log('ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«:', reservationTable);
            console.log('Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ:', !!window.supabase);

            const tbody = document.querySelector('#reservationTable tbody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:20px;"><i class="fas fa-spinner fa-spin"></i> èª­ã¿è¾¼ã¿ä¸­...</td></tr>';

            // é¸æŠã•ã‚ŒãŸæœˆã‚’å–å¾—
            const monthFilter = document.getElementById('monthFilter');
            let startDate, endDate;

            if (monthFilter && monthFilter.value) {
                const [year, month] = monthFilter.value.split('-').map(Number);
                startDate = new Date(year, month - 1, 1);
                endDate = new Date(year, month, 0, 23, 59, 59); // æœˆæœ«
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ä»Šæœˆ
                const now = new Date();
                startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
            }

            const startDateStr = startDate.toISOString();
            const endDateStr = endDate.toISOString();

            console.log('ğŸ“… ãƒ•ã‚£ãƒ«ã‚¿æœŸé–“:', { startDate: startDateStr, endDate: endDateStr });

            try {
                const { data, error } = await window.supabase
                    .from(reservationTable)
                    .select('*')
                    .gte('datetime', startDateStr)
                    .lte('datetime', endDateStr)
                    .order('datetime', { ascending: true });

                console.log('ğŸ” äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—çµæœ:', { data, error, count: data?.length });

                tbody.innerHTML = '';

                if (error) {
                    console.error('âŒ äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    throw error;
                }

                // æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’è¡¨ç¤º
                const updateTimeElement = document.getElementById('lastUpdateTime');
                if (updateTimeElement) {
                    updateTimeElement.textContent = `æœ€çµ‚æ›´æ–°: ${new Date().toLocaleTimeString()}`;
                }

                if (!data || data.length === 0) {
                    console.log('ğŸ“­ äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã§ã™');
                    const [year, month] = (monthFilter?.value || `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`).split('-');
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:20px;color:#666;">${year}å¹´${parseInt(month)}æœˆã®äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>`;
                    return;
                }

                console.log('âœ… äºˆç´„ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºé–‹å§‹:', data.length + 'ä»¶');

                data.forEach(reservation => {
                    const tr = document.createElement('tr');

                    // éå»ã®äºˆç´„ã¯èƒŒæ™¯è‰²ã‚’å¤‰æ›´
                    const reservationDate = new Date(reservation.datetime);
                    const now = new Date();
                    if (reservationDate < now) {
                        tr.style.backgroundColor = '#f8f9fa';
                        tr.style.color = '#6c757d';
                    }

                    // æ–°è¦é¡§å®¢ã®è¡¨ç¤ºå‡¦ç†
                    const customerTypeDisplay = reservation.is_new_customer === true ?
                        '<span style="background:#28a745;color:white;padding:2px 6px;border-radius:3px;font-size:12px;"><i class="fas fa-star"></i> æ–°è¦</span>' :
                        '<span style="background:#6c757d;color:white;padding:2px 6px;border-radius:3px;font-size:12px;">ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</span>';

                    // ãƒªãƒ•ã‚¡ãƒ©ãƒ¼ã®è¡¨ç¤ºå‡¦ç†
                    const referralDisplay = {
                        'instagram': '<i class="fab fa-instagram" style="color:#E4405F;"></i> Instagram',
                        'line': '<i class="fab fa-line" style="color:#00C300;"></i> LINE',
                        'google_search': '<i class="fab fa-google" style="color:#4285F4;"></i> ã‚°ãƒ¼ã‚°ãƒ«',
                        'yahoo_search': '<i class="fas fa-search" style="color:#FF0033;"></i> ãƒ¤ãƒ•ãƒ¼',
                        'referral': '<i class="fas fa-users" style="color:#17a2b8;"></i> ç´¹ä»‹',
                        'flyer': '<i class="fas fa-newspaper" style="color:#ffc107;"></i> ãƒãƒ©ã‚·',
                        'other': '<i class="fas fa-question" style="color:#6c757d;"></i> ãã®ä»–'
                    }[reservation.referral_source] || 'æœªè¨­å®š';

                    tr.innerHTML = `
                        <td>${reservation.name}</td>
                        <td>${reservation.phone}</td>
                        <td>${formatDateWithDay(reservation.datetime)}</td>
                        <td>${reservation.course}</td>
                        <td>${customerTypeDisplay}</td>
                        <td>${referralDisplay}</td>
                        <td>
                            <button class="btn btn-danger" onclick="showCancelModal(${reservation.id}, '${reservation.name}', '${reservation.datetime}', '${reservation.phone}')">
                                <i class="fas fa-trash"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('äºˆç´„ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:20px;color:#dc3545;">å–å¾—ã‚¨ãƒ©ãƒ¼</td></tr>';
            }
        }

        // æ™‚é–“é¸æŠè‚¢ã®ç”Ÿæˆ
        function generateTimeOptions() {
            const timeSelects = ['closedTimeStart', 'closedTimeEnd', 'openTimeStart', 'openTimeEnd'];
            timeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                
                // åˆæœŸçŠ¶æ…‹ã§ã¯æ—¥ä»˜ãŒé¸æŠã•ã‚Œã¦ã„ãªã„ãŸã‚ç„¡åŠ¹åŒ–
                if (selectId.includes('closed')) {
                    const dateInput = document.getElementById('closedTimeDate');
                    if (!dateInput.value) {
                        select.innerHTML = selectId.includes('Start') ? '<option value="">é–‹å§‹æ™‚é–“</option>' : '<option value="">çµ‚äº†æ™‚é–“</option>';
                        select.disabled = true;
                        return;
                    }
                } else if (selectId.includes('open')) {
                    const dateInput = document.getElementById('openTimeDate');
                    if (!dateInput.value) {
                        select.innerHTML = selectId.includes('Start') ? '<option value="">é–‹å§‹æ™‚é–“</option>' : '<option value="">çµ‚äº†æ™‚é–“</option>';
                        select.disabled = true;
                        return;
                    }
                }
                
                select.innerHTML = selectId.includes('Start') ? '<option value="">é–‹å§‹æ™‚é–“</option>' : '<option value="">çµ‚äº†æ™‚é–“</option>';
                
                // å¹³æ—¥ãƒ»åœŸæ›œã®å–¶æ¥­æ™‚é–“ã‚’åŸºæº–ã«é¸æŠè‚¢ç”Ÿæˆï¼ˆ9:00ã€œ18:30ã€çµ‚äº†å¢ƒç•Œç”¨ã«19:00ï¼‰
                for (let h = 9; h <= 18; h++) {
                    ['00', '30'].forEach(min => {
                        // 18:30ã¾ã§å«ã‚€ã‚ˆã†ã«æ¡ä»¶ã‚’ä¿®æ­£
                        if (h < 18 || (h === 18 && min === '30') || (h === 18 && min === '00')) {
                            const time = `${h.toString().padStart(2, '0')}:${min}`;
                            select.innerHTML += `<option value="${time}">${time}</option>`;
                        }
                    });
                }

                // 18:30æ ã‚’æ¶ˆã™ãŸã‚ã®çµ‚ç«¯ï¼ˆ18:30ã€œ19:00ã®ç¯„å›²æŒ‡å®šç”¨ï¼‰
                select.innerHTML += '<option value="19:00">19:00</option>';
                
                select.disabled = false;
            });
        }
        
        // æ—¥ä»˜å¤‰æ›´æ™‚ã®é€£å‹•å‡¦ç†è¨­å®š
        function setupDateChangeHandlers() {
            // ä¼‘æ¥­è¨­å®šã®æ—¥ä»˜å¤‰æ›´æ™‚
            document.getElementById('closedDate').addEventListener('change', async function() {
                const date = this.value;
                if (!date) return;
                
                // çµ‚æ—¥ä¼‘æ¥­è¨­å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const isDayClosed = await checkDayClosedStatus(date);
                const timeInput = document.getElementById('closedTimeDate');
                const timeSelect = document.getElementById('closedTime');
                
                const timeStartSelect = document.getElementById('closedTimeStart');
                const timeEndSelect = document.getElementById('closedTimeEnd');
                
                if (isDayClosed) {
                    timeInput.disabled = true;
                    timeStartSelect.disabled = true;
                    timeEndSelect.disabled = true;
                    timeStartSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                    timeEndSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                } else {
                    timeInput.disabled = false;
                    timeStartSelect.disabled = false;
                    timeEndSelect.disabled = false;
                    generateTimeOptions();
                }
            });
            
            // æ™‚é–“æŒ‡å®šä¼‘æ¥­ã®æ—¥ä»˜å¤‰æ›´æ™‚
            document.getElementById('closedTimeDate').addEventListener('change', async function() {
                const date = this.value;
                const timeStartSelect = document.getElementById('closedTimeStart');
                const timeEndSelect = document.getElementById('closedTimeEnd');
                
                if (!date) {
                    timeStartSelect.innerHTML = '<option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                    timeEndSelect.innerHTML = '<option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                    timeStartSelect.disabled = true;
                    timeEndSelect.disabled = true;
                    return;
                }
                
                // çµ‚æ—¥ä¼‘æ¥­è¨­å®šãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const isDayClosed = await checkDayClosedStatus(date);
                
                if (isDayClosed) {
                    timeStartSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                    timeEndSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                    timeStartSelect.disabled = true;
                    timeEndSelect.disabled = true;
                } else {
                    timeStartSelect.disabled = false;
                    timeEndSelect.disabled = false;
                    generateTimeOptions();
                }
            });
            
            // å–¶æ¥­å†é–‹ã®æ—¥ä»˜å¤‰æ›´æ™‚ã‚‚åŒæ§˜ã«å‡¦ç†
            document.getElementById('openTimeDate').addEventListener('change', async function() {
                const date = this.value;
                const timeStartSelect = document.getElementById('openTimeStart');
                const timeEndSelect = document.getElementById('openTimeEnd');
                
                if (!date) {
                    timeStartSelect.innerHTML = '<option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                    timeEndSelect.innerHTML = '<option value="">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
                    timeStartSelect.disabled = true;
                    timeEndSelect.disabled = true;
                    return;
                }
                
                timeStartSelect.disabled = false;
                timeEndSelect.disabled = false;
                generateTimeOptions();
            });
        }
        
        // çµ‚æ—¥ä¼‘æ¥­è¨­å®šçŠ¶æ…‹ã‚’ç¢ºèª
        async function checkDayClosedStatus(date) {
            try {
                const { data, error } = await window.supabase
                    .from(scheduleTable)
                    .select('*')
                    .eq('date', date)
                    .eq('status', 'closed')
                    .is('time', null);
                
                if (error) {
                    console.error('ä¼‘æ¥­çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                    return false;
                }
                
                return data && data.length > 0;
            } catch (error) {
                console.error('ä¼‘æ¥­çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                return false;
            }
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†æ©Ÿèƒ½
        async function setDayClosed() {
            const date = document.getElementById('closedDate').value;
            if (!date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                await window.supabase.from(scheduleTable).insert({
                    date: date,
                    time: null,
                    status: 'closed',
                    created_at: new Date().toISOString()
                });
                
                alert('ä¼‘æ¥­æ—¥ã‚’è¨­å®šã—ã¾ã—ãŸ');
                loadScheduleOverrides();
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    document.getElementById('scheduleTable').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 300);
                
                // æ™‚é–“æŒ‡å®šä¼‘æ¥­ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
                const timeDate = document.getElementById('closedTimeDate');
                const timeStartSelect = document.getElementById('closedTimeStart');
                const timeEndSelect = document.getElementById('closedTimeEnd');
                if (timeDate.value === date) {
                    timeDate.disabled = true;
                    timeStartSelect.disabled = true;
                    timeEndSelect.disabled = true;
                    timeStartSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                    timeEndSelect.innerHTML = '<option value="">çµ‚æ—¥ä¼‘æ¥­è¨­å®šæ¸ˆã¿</option>';
                }
            } catch (error) {
                console.error('ä¼‘æ¥­è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function setTimeRangeClosed() {
            const date = document.getElementById('closedTimeDate').value;
            const startTime = document.getElementById('closedTimeStart').value;
            const endTime = document.getElementById('closedTimeEnd').value;
            
            if (!date || !startTime || !endTime) {
                alert('æ—¥ä»˜ã€é–‹å§‹æ™‚é–“ã€çµ‚äº†æ™‚é–“ã‚’ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ™‚é–“ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
            if (startTime >= endTime) {
                alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šæ—©ãè¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                // æŒ‡å®šç¯„å›²ã®å„æ™‚é–“å¸¯ã‚’ä¼‘æ¥­è¨­å®š
                const times = generateTimeRange(startTime, endTime);
                
                for (const time of times) {
                    await window.supabase.from(scheduleTable).insert({
                        date: date,
                        time: time,
                        start_time: startTime,
                        end_time: endTime,
                        status: 'closed',
                        created_at: new Date().toISOString()
                    });
                }
                
                alert(`ä¼‘æ¥­æ™‚é–“ã‚’è¨­å®šã—ã¾ã—ãŸï¼ˆ${startTime}ã€œ${endTime}ï¼‰`);
                loadScheduleOverrides();
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    document.getElementById('scheduleTable').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 300);
            } catch (error) {
                console.error('ä¼‘æ¥­è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function setDayOpen() {
            const date = document.getElementById('openDate').value;
            if (!date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                await window.supabase.from(scheduleTable).insert({
                    date: date,
                    time: null,
                    status: 'open',
                    created_at: new Date().toISOString()
                });
                
                alert('å–¶æ¥­æ—¥ã‚’è¨­å®šã—ã¾ã—ãŸ');
                loadScheduleOverrides();
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    document.getElementById('scheduleTable').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 300);
                
                // æ™‚é–“æŒ‡å®šä¼‘æ¥­ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
                const timeDate = document.getElementById('closedTimeDate');
                const timeStartSelect = document.getElementById('closedTimeStart');
                const timeEndSelect = document.getElementById('closedTimeEnd');
                if (timeDate.value === date) {
                    timeDate.disabled = false;
                    timeStartSelect.disabled = false;
                    timeEndSelect.disabled = false;
                    generateTimeOptions();
                }
            } catch (error) {
                console.error('å–¶æ¥­è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function setTimeRangeOpen() {
            const date = document.getElementById('openTimeDate').value;
            const startTime = document.getElementById('openTimeStart').value;
            const endTime = document.getElementById('openTimeEnd').value;
            
            if (!date || !startTime || !endTime) {
                alert('æ—¥ä»˜ã€é–‹å§‹æ™‚é–“ã€çµ‚äº†æ™‚é–“ã‚’ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ™‚é–“ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
            if (startTime >= endTime) {
                alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šæ—©ãè¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                // æŒ‡å®šç¯„å›²ã®å„æ™‚é–“å¸¯ã®æ—¢å­˜ä¼‘æ¥­è¨­å®šã‚’å‰Šé™¤
                const times = generateTimeRange(startTime, endTime);
                
                // ã¾ãšæ—¢å­˜ã®ä¼‘æ¥­è¨­å®šã‚’å‰Šé™¤
                for (const time of times) {
                    await window.supabase.from(scheduleTable)
                        .delete()
                        .eq('date', date)
                        .eq('time', time)
                        .eq('status', 'closed');
                }
                
                // æ–°ã—ã„å–¶æ¥­è¨­å®šã‚’è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
                for (const time of times) {
                    await window.supabase.from(scheduleTable).insert({
                        date: date,
                        time: time,
                        start_time: startTime,
                        end_time: endTime,
                        status: 'open',
                        created_at: new Date().toISOString()
                    });
                }
                
                alert(`å–¶æ¥­æ™‚é–“ã‚’è¨­å®šã—ã¾ã—ãŸï¼ˆ${startTime}ã€œ${endTime}ï¼‰`);
                loadScheduleOverrides();
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    document.getElementById('scheduleTable').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 300);
            } catch (error) {
                console.error('å–¶æ¥­è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        // æ™‚é–“ç¯„å›²ã‹ã‚‰30åˆ†å˜ä½ã®æ™‚é–“é…åˆ—ã‚’ç”Ÿæˆ
        function generateTimeRange(startTime, endTime) {
            const times = [];
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            
            let currentHour = startHour;
            let currentMin = startMin;
            
            // çµ‚äº†æ™‚é–“ã¯å«ã¾ãªã„ï¼ˆä¾‹ï¼š15:00ã€œ18:00ãªã‚‰ã€18:00ã¯å–¶æ¥­å†é–‹æ™‚é–“ãªã®ã§ä¼‘æ¥­å¯¾è±¡å¤–ï¼‰
            while (currentHour < endHour || (currentHour === endHour && currentMin < endMin)) {
                const timeStr = `${currentHour.toString().padStart(2, '0')}:${currentMin.toString().padStart(2, '0')}`;
                times.push(timeStr);
                
                currentMin += 30;
                if (currentMin >= 60) {
                    currentMin = 0;
                    currentHour++;
                }
            }
            
            console.log(`æ™‚é–“ç¯„å›² ${startTime}ã€œ${endTime} â†’ ç”Ÿæˆã•ã‚ŒãŸæ™‚é–“:`, times);
            return times;
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´ã®èª­ã¿è¾¼ã¿
        async function loadScheduleOverrides() {
            const tbody = document.querySelector('#scheduleTable tbody');
            if (!tbody) return;
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;"><i class="fas fa-spinner fa-spin"></i> èª­ã¿è¾¼ã¿ä¸­...</td></tr>';

            const { startDateStr, endDateStr, label: monthLabel } = getMonthRangeFromSelect('scheduleMonthFilter');

            try {
                const { data, error } = await window.supabase
                    .from(scheduleTable)
                    .select('*')
                    .gte('date', startDateStr)
                    .lte('date', endDateStr)
                    .order('date', { ascending: false })
                    .order('start_time', { ascending: true, nullsFirst: true });

                tbody.innerHTML = '';

                if (error) throw error;

                const updateTimeElement = document.getElementById('scheduleLastUpdateTime');
                if (updateTimeElement) {
                    updateTimeElement.textContent = `æœ€çµ‚æ›´æ–°: ${new Date().toLocaleTimeString()}`;
                }

                if (!data || data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#666;">${monthLabel}ã®è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>`;
                    return;
                }

                const normalizeTime = (value) => typeof value === 'string' ? value.slice(0, 5) : '';
                const formatTimeCell = (value, fallbackLabel = 'çµ‚æ—¥') => value ? normalizeTime(value) : fallbackLabel;

                const groupedSchedules = {};
                data.forEach(schedule => {
                    const startKey = schedule.start_time ? normalizeTime(schedule.start_time) : (schedule.time ? normalizeTime(schedule.time) : 'day');
                    const endKey = schedule.end_time ? normalizeTime(schedule.end_time) : (schedule.time ? normalizeTime(schedule.time) : 'day');
                    const key = `${schedule.date}_${schedule.status}_${startKey}_${endKey}`;
                    if (!groupedSchedules[key]) {
                        groupedSchedules[key] = {
                            ...schedule,
                            start_display: schedule.start_time ? formatTimeCell(schedule.start_time) : (schedule.time ? formatTimeCell(schedule.time) : 'çµ‚æ—¥'),
                            end_display: schedule.end_time ? formatTimeCell(schedule.end_time) : (schedule.time ? formatTimeCell(schedule.time) : 'çµ‚æ—¥'),
                            ids: [schedule.id]
                        };
                    } else {
                        groupedSchedules[key].ids.push(schedule.id);
                    }
                });

                Object.values(groupedSchedules).forEach(schedule => {
                    const tr = document.createElement('tr');

                    const dateWithDay = (() => {
                        const dt = new Date(schedule.date + 'T00:00:00');
                        const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                        const dayName = dayNames[dt.getDay()];
                        return `${schedule.date} (${dayName})`;
                    })();

                    tr.innerHTML = `
                        <td>${dateWithDay}</td>
                        <td>${schedule.start_display}</td>
                        <td>${schedule.end_display}</td>
                        <td>
                            <span class="badge" style="font-weight: bold; padding: 10px 16px; color: white; background: ${schedule.status === 'closed' ? '#b71c1c' : '#1b5e20'}; border-radius: 6px;">
                                ${schedule.status === 'closed' ? 'ğŸš« ä¼‘æ¥­' : 'âœ… å–¶æ¥­'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteScheduleGroup([${schedule.ids.join(',')}])">
                                <i class="fas fa-trash"></i> å‰Šé™¤
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#dc3545;">å–å¾—ã‚¨ãƒ©ãƒ¼</td></tr>';
            }
        }

        async function deleteScheduleOverride(id) {
            if (!confirm('ã“ã®è¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                // å‰Šé™¤å‰ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—
                const { data: scheduleData } = await window.supabase
                    .from(scheduleTable)
                    .select('*')
                    .eq('id', id)
                    .single();
                
                await window.supabase.from(scheduleTable).delete().eq('id', id);
                
                // å‰Šé™¤ã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (scheduleData) {
                    const dateWithDay = (() => {
                        const dt = new Date(scheduleData.date + 'T00:00:00');
                        const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                        const dayName = dayNames[dt.getDay()];
                        return `${scheduleData.date} (${dayName})`;
                    })();
                    
                    const timeInfo = scheduleData.start_time && scheduleData.end_time ? 
                        `${scheduleData.start_time}ã€œ${scheduleData.end_time}` : 
                        (scheduleData.time || 'çµ‚æ—¥');
                    
                    const statusText = scheduleData.status === 'closed' ? 'ä¼‘æ¥­' : 'å–¶æ¥­';
                    alert(`${dateWithDay} ${timeInfo}ã®${statusText}è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                } else {
                    alert('è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                }
                loadScheduleOverrides();
                
                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®çŠ¶æ…‹ã‚’æ›´æ–°
                const closedDate = document.getElementById('closedDate').value;
                const closedTimeDate = document.getElementById('closedTimeDate').value;
                if (closedDate || closedTimeDate) {
                    // æ—¥ä»˜å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã¦é€£å‹•å‡¦ç†ã‚’å®Ÿè¡Œ
                    if (closedDate) {
                        document.getElementById('closedDate').dispatchEvent(new Event('change'));
                    }
                    if (closedTimeDate) {
                        document.getElementById('closedTimeDate').dispatchEvent(new Event('change'));
                    }
                }
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function deleteScheduleGroup(ids) {
            if (!confirm('ã“ã®æ™‚é–“ç¯„å›²ã®è¨­å®šã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                // å‰Šé™¤å‰ã«æœ€åˆã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—ï¼ˆä»£è¡¨ã¨ã—ã¦ï¼‰
                const { data: scheduleData } = await window.supabase
                    .from(scheduleTable)
                    .select('*')
                    .eq('id', ids[0])
                    .single();
                
                for (const id of ids) {
                    await window.supabase.from(scheduleTable).delete().eq('id', id);
                }
                
                // å‰Šé™¤ã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (scheduleData) {
                    const dateWithDay = (() => {
                        const dt = new Date(scheduleData.date + 'T00:00:00');
                        const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                        const dayName = dayNames[dt.getDay()];
                        return `${scheduleData.date} (${dayName})`;
                    })();
                    
                    const timeInfo = scheduleData.start_time && scheduleData.end_time ? 
                        `${scheduleData.start_time}ã€œ${scheduleData.end_time}` : 
                        (scheduleData.time || 'çµ‚æ—¥');
                    
                    const statusText = scheduleData.status === 'closed' ? 'ä¼‘æ¥­' : 'å–¶æ¥­';
                    alert(`${dateWithDay} ${timeInfo}ã®${statusText}è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                } else {
                    alert('è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                }
                loadScheduleOverrides();
                
                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®çŠ¶æ…‹ã‚’æ›´æ–°
                const closedDate = document.getElementById('closedDate').value;
                const closedTimeDate = document.getElementById('closedTimeDate').value;
                if (closedDate || closedTimeDate) {
                    if (closedDate) {
                        document.getElementById('closedDate').dispatchEvent(new Event('change'));
                    }
                    if (closedTimeDate) {
                        document.getElementById('closedTimeDate').dispatchEvent(new Event('change'));
                    }
                }
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
        let currentCancelId = null;
        let currentCancelData = null;

        window.showCancelModal = function(id, name, datetime, phone) {
            currentCancelId = id;
            currentCancelData = { name, datetime, phone };
            const modal = document.getElementById('cancelModal');
            const message = document.getElementById('cancelMessage');
            message.innerHTML = `
                <strong>${name}æ§˜</strong>ã®äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ<br>
                <small style="color:#666;">æ—¥æ™‚: ${datetime.replace('T', ' ').slice(0,16)}</small>
            `;
            modal.style.display = 'block';
        };

        async function handleCancelConfirm() {
            if (!currentCancelId) return;
            
            const btn = document.getElementById('confirmCancel');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å‡¦ç†ä¸­...';
            
            try {
                // Supabaseã‹ã‚‰äºˆç´„å‰Šé™¤
                const { error } = await window.supabase
                    .from(reservationTable)
                    .delete()
                    .eq('id', currentCancelId);
                
                if (error) throw error;
                
                // ===============================
                // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆãƒ†ã‚¹ãƒˆæ™‚ã¯ç„¡åŠ¹åŒ–ï¼‰
                // ===============================
                /*
                if (window.emailJSEnabled) {
                    try {
                        await emailjs.send('service_ppi835a', 'template_jcdlzq6', {
                            name: currentCancelData.name,
                            phone: currentCancelData.phone,
                            datetime: currentCancelData.datetime,
                            course: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                            to_email: 'nagomi.y.c.j.t@gmail.com',
                            user_email: '',
                            message: `äºˆç´„ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚\n\nã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«å†…å®¹ã€‘\næ°å: ${currentCancelData.name}\né›»è©±: ${currentCancelData.phone}\næ—¥æ™‚: ${currentCancelData.datetime.replace('T', ' ')}`
                        });
                    } catch (emailError) {
                        console.error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼:', emailError);
                    }
                }
                */
                console.log('ğŸ“§ ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯ãƒ†ã‚¹ãƒˆç”¨ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ');
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
                document.getElementById('cancelModal').style.display = 'none';
                
                // äºˆç´„ä¸€è¦§æ›´æ–°
                loadReservations();
                
                // æ—¥æ™‚ã‚’èª­ã¿ã‚„ã™ã„å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                const formattedDateTime = formatDateWithDay(currentCancelData.datetime);
                alert(`${currentCancelData.name}æ§˜ã®${formattedDateTime}ã®äºˆç´„ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                
            } catch (error) {
                console.error('ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-trash"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹';
                currentCancelId = null;
                currentCancelData = null;
            }
        }


    </script>
</body>
</html>